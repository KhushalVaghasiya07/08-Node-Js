<%- include("../header") %>

  <div class="page-wrapper">
    <div class="page-breadcrumb">
      <div class="row">
        <div class="col-12 d-flex no-block align-items-center">
          <h4 class="page-title">Edit Product</h4>
        </div>
      </div>
    </div>
    <div class="container-fluid">
      <div class="row">
        <div class="col-md-6">
          <div class="card">
            <form class="form-horizontal" action="/Product/editProduct/<%= product._id %>" method="post"
              enctype="multipart/form-data">
              <div class="card-body">
                <!-- Category Dropdown -->
                <div class="form-group row">
                  <label for="category" class="col-sm-3 text-right control-label col-form-label">
                    Category <i class="fas fa-list-alt ml-2"></i>
                  </label>
                  <div class="col-sm-9">
                    <select name="category" id="category" class="form-control">
                      <option value="">Select Category</option>
                      <% catagories.forEach(cat=> { %>
                        <option value="<%= cat._id %>" <%=product.category &&
                          product.category._id.toString()===cat._id.toString() ? 'selected' : '' %>>
                          <%= cat.CatagoryTitle %>
                        </option>
                        <% }) %>
                    </select>
                  </div>
                </div>
                <!-- SubCategory Dropdown -->
                <div class="form-group row">
                  <label for="subCategory" class="col-sm-3 text-right control-label col-form-label">
                    SubCategory <i class="fas fa-sitemap ml-2"></i>
                  </label>
                  <div class="col-sm-9">
                    <select name="subCategoryTitle" id="subCategory" class="form-control">
                      <option value="">Select Sub Category</option>
                      <% subCatagories.forEach(subCat=> { %>
                        <option value="<%= subCat._id %>" <%=product.subCategoryTitle &&
                          product.subCategoryTitle._id.toString()===subCat._id.toString() ? 'selected' : '' %>>
                          <%= subCat.subCatagoryTitle %>
                        </option>
                        <% }) %>
                    </select>
                  </div>
                </div>
                <!-- ExtraSubCategory Dropdown -->
                <div class="form-group row">
                  <label for="extraSubCategory" class="col-sm-3 text-right control-label col-form-label">
                    ExtraSubCategory <i class="fas fa-tags ml-2"></i>
                  </label>
                  <div class="col-sm-9">
                    <select name="extraSubCategoryTitle" id="extraSubCategory" class="form-control">
                      <option value="">Select Extra Sub Category</option>
                      <% extSubCatagories.forEach(extsubCat=> { %>
                        <option value="<%= extsubCat._id %>" <%=product.extraSubCategoryTitle &&
                          product.extraSubCategoryTitle._id.toString()===extsubCat._id.toString() ? 'selected' : '' %>>
                          <%= extsubCat.extraSubCatagoryTitle %>
                        </option>
                        <% }) %>
                    </select>
                  </div>
                </div>
                <!-- Product Name -->
                <div class="form-group row">
                  <label for="productName" class="col-sm-3 text-right control-label col-form-label">
                    Product Name <i class="fas fa-box ml-2"></i>
                  </label>
                  <div class="col-sm-9">
                    <input type="text" class="form-control" name="productName" id="productName"
                      value="<%= product.productName %>" required>
                  </div>
                </div>
                <!-- Product Price -->
                <div class="form-group row">
                  <label for="productPrice" class="col-sm-3 text-right control-label col-form-label">
                    Price <i class="fas fa-rupee-sign ml-2"></i>
                  </label>
                  <div class="col-sm-9">
                    <input type="number" class="form-control" name="productPrice" id="productPrice"
                      value="<%= product.productPrice %>" min="0" step="0.01" required>
                  </div>
                </div>
                <!-- Product Description -->
                <div class="form-group row">
                  <label for="productDescription" class="col-sm-3 text-right control-label col-form-label">
                    Description <i class="fas fa-align-left ml-2"></i>
                  </label>
                  <div class="col-sm-9">
                    <textarea class="form-control" name="productDescription" id="productDescription" rows="3"
                      required><%= product.productDescription %></textarea>
                  </div>
                </div>
                <!-- Product Image -->
                <div class="form-group row">
                  <label for="productImage" class="col-sm-3 text-right control-label col-form-label">
                    Image <i class="fas fa-image ml-2"></i>
                  </label>
                  <div class="col-sm-9">
                    <% if (product.productImage) { %>
                      <img src="<%= product.productImage %>" alt="Product Image"
                        style="width:80px; height:80px; object-fit:cover; margin-bottom:10px;">
                      <% } %>
                        <input type="file" class="form-control" name="productImage" id="productImage" accept="image/*">
                  </div>
                </div>
                <!-- Product Discount -->
                <div class="form-group row">
                  <label for="productDiscount" class="col-sm-3 text-right control-label col-form-label">
                    Discount <i class="fas fa-percent ml-2"></i>
                  </label>
                  <div class="col-sm-9">
                    <input type="number" class="form-control" name="productDiscount" id="productDiscount"
                      value="<%= product.productDiscount %>" min="0" max="100" step="0.01">
                  </div>
                </div>
              </div>
              <div class="border-top">
                <div class="card-body">
                  <button type="submit" class="btn btn-primary">Update Product</button>
                  <a href="/Product/viewAllProduct" class="btn btn-secondary ml-2">Cancel</a>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <%- include("../footer") %>

      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

      <script>
        // Dependent dropdowns for edit page
        document.getElementById("category").addEventListener("change", async function () {
          let catId = this.value;
          let subSelect = document.getElementById("subCategory");
          subSelect.innerHTML = "<option value=''>Select Sub Category</option>";

          if (catId) {
            let res = await fetch(`/Product/getSubCategories/${catId}`);
            let data = await res.json();
              data.forEach(sc => {
                let opt = document.createElement("option");
              opt.value = sc._id;
              opt.textContent = sc.subCatagoryTitle;
              subSelect.appendChild(opt);
            });
          }
        });

        document.getElementById("subCategory").addEventListener("change", async function () {
          let subCatId = this.value;
          let extraSelect = document.getElementById("extraSubCategory");
          extraSelect.innerHTML = "<option value=''>Select Extra Sub Category</option>";

          if (subCatId) {
            let res = await fetch(`/Product/getExtraSubCategories/${subCatId}`);
            let data = await res.json();
            data.forEach(ex => {
              let opt = document.createElement("option");
              opt.value = ex._id;
              opt.textContent = ex.extraSubCatagoryTitle;
              extraSelect.appendChild(opt);
            });
          }
        });
      </script>